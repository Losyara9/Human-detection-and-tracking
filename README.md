# Система детекции и трекинга людей

Проект для детекции людей на видео, трекинга и визуализации траекторий на 2D-карте с использованием YOLOv8, OpenCV и FastAPI.

---

## Общее описание

Приложение позволяет:

- **Загружать видео** через веб-интерфейс и обрабатывать его на сервере.
- **Калибровать сцену** по четырём точкам на первом кадре (углы области пола: TL → TR → BR → BL), при необходимости указывать реальные размеры области в метрах.
- **В реальном времени** получать:
  - видеопоток с рамками детекций;
  - 2D-карту пола с траекториями;
  - статистику (FPS, число людей, кадр).
- **Скачивать результаты**: видео с детекциями, видео 2D-карты, траектории в Excel, PDF-отчёт.

Детекция выполняется моделью YOLOv8 (класс «person»), трекинг — упрощённым многокадровым сопоставлением по IoU. Координаты «стопы» (нижний центр bbox) проецируются на плоскость пола через гомографию и отображаются на виртуальной 2D-карте.


---

## Инструкция по запуску

### Требования

- Python 3.9+
- Модель YOLO: либо будет загружена при первом запуске (нужен интернет), либо положите свой файл модели в **`data/yolo/yolov8n.pt`** и задайте переменную окружения **`MODEL_PATH`**

### Установка

1. Клонировать или открыть каталог проекта и перейти в него.
2. Создать виртуальное окружение:
   ```bash
   python -m venv .venv
   # Windows:
   .venv\Scripts\activate
   # Linux/macOS:
   source .venv/bin/activate
   ```
3. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### Запуск веб-интерфейса (рекомендуемый способ)

Из корня проекта:

```bash
python launch_web.py --mode fastapi --open-browser
```

Сервер будет доступен по адресу `http://127.0.0.1:8000`. Браузер откроется на странице Swagger (`/docs`). Веб-панель: **http://127.0.0.1:8000/static/index.html**.

Без авто-открытия браузера:

```bash
python launch_web.py --mode fastapi
```

Дополнительные опции: `--host`, `--fastapi-port`, `--reload` (см. `python launch_web.py --help`).

### Запуск через uvicorn напрямую

```bash
uvicorn app:app --host 127.0.0.1 --port 8000
```

После запуска открыть в браузере: **http://127.0.0.1:8000/static/index.html**.

### CLI (без веб-сервера)

Обработка одного видео из командной строки:

```bash
python main.py --video data/videos/sample.mp4 --show
```

---

